# 1. ê¸°ë³¸ ì„¤ì •
FROM nvidia/cuda:11.8.0-cudnn8-runtime-ubuntu22.04
WORKDIR /app
RUN apt update && apt install -y python3 python3-pip git && rm -rf /var/lib/apt/lists/*

# 2. íŒŒì´ì¬ í™˜ê²½ ì„¤ì •
RUN pip install --upgrade pip

# 3. ğŸ”¹ requirements.txt ë¨¼ì € ë³µì‚¬ â†’ ë³€ê²½ ì—†ìœ¼ë©´ ìºì‹œ ìœ ì§€ë¨
COPY requirements.txt .

# 4. ğŸ”¹ ì¼ë°˜ íŒ¨í‚¤ì§€ ë¨¼ì € ì„¤ì¹˜ (ë³€ê²½ ì—†ìœ¼ë©´ ìºì‹œ í™œìš©)
RUN pip install -r requirements.txt

# 5. ğŸ”¹ HuggingFace ê´€ë ¨ íŒ¨í‚¤ì§€ ë”°ë¡œ ì„¤ì¹˜ (í° íŒ¨í‚¤ì§€ëŠ” ë”°ë¡œ ê´€ë¦¬)
RUN pip install llama-index-embeddings-huggingface

# 6. ğŸ”¹ channels_redis ì¶”ê°€ ì„¤ì¹˜ (ì´ì „ ë‹¨ê³„ì—ì„œ ì„¤ì¹˜ ì•ˆ ë˜ë©´ ì¶”ê°€)
RUN pip install channels_redis

# 7. ëª¨ë¸ ë° ì½”ë“œ ë³µì‚¬ (ì½”ë“œ ë³€ê²½ ì‹œ ì´ ë‹¨ê³„ë¶€í„° ìƒˆë¡œ ë¹Œë“œ)
COPY . .

# 8. í¬íŠ¸ ì„¤ì •
EXPOSE 9090

# 9. ì‹¤í–‰ ëª…ë ¹
CMD ["daphne", "-b", "0.0.0.0", "-p", "9090", "kollamadjango.asgi:application"]
